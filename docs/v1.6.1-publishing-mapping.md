# ðŸ“¤ v1.6.1 Publishing Enhancements Mapping

**Version:** 1.6.1  
**Focus:** Publishing Preflight & Auto-generation  
**Created:** October 18, 2025  
**Status:** STAGED

---

## ðŸŽ¯ Publishing Preflight System

### **Overview**
Pre-publish validation and auto-generation system that ensures prompts are properly categorized, tagged, titled, and validated before public release.

### **Preflight Sequence**
```yaml
1. Term Analysis â†’ Extract keywords from prompt content
2. Category Assignment â†’ Auto-select or suggest category
3. Tag Generation â†’ Create 3-5 relevant tags
4. Title Generation â†’ Auto-generate or validate manual title
5. Slug Creation â†’ Generate unique, SEO-friendly slug
6. Duplicate Check â†’ Ensure uniqueness across system
7. Validation â†’ Final checks before emit
8. Payload Emit â†’ Send to storage/API
9. Outcome Logging â†’ Record preflight results
```

---

## ðŸ·ï¸ Term Preflight System

### **Auto-Category Assignment**
```yaml
Component: CategoryAnalyzer
Input: 
  - mode: PromptMode (template/agent/blueprint)
  - content: Generated prompt text
  - formData: User input fields

Process:
  1. Extract key terms from:
     - goal/title (primary weight: 40%)
     - description/context (secondary weight: 30%)
     - tone/style (tertiary weight: 20%)
     - use case (context weight: 10%)
  
  2. Match against category taxonomy:
     Categories:
       - business-marketing (keywords: sales, marketing, ROI, conversion)
       - creative-writing (keywords: story, narrative, fiction, creative)
       - technical-coding (keywords: code, API, function, debug)
       - education-training (keywords: teach, learn, course, tutorial)
       - data-analysis (keywords: analyze, metrics, insights, data)
       - customer-support (keywords: help, support, assist, resolve)
       - content-creation (keywords: blog, article, social, content)
       - research-academic (keywords: research, study, paper, thesis)
       - media-production (keywords: video, image, audio, media)
       - general-purpose (fallback category)
  
  3. Confidence scoring:
     - High (>80%): Auto-assign category
     - Medium (50-80%): Suggest with confirmation
     - Low (<50%): User selects manually

Output:
  category: string
  confidence: number
  reasoning: string[]
```

### **Auto-Tag Generation**
```yaml
Component: TagGenerator
Input:
  - category: Assigned category
  - prompt: Generated content
  - formData: User inputs

Process:
  1. Extract noun phrases and key concepts
  2. Remove stop words and common terms
  3. Apply TF-IDF scoring
  4. Select top 3-5 tags
  5. Validate against tag rules:
     - Min length: 2 characters
     - Max length: 25 characters
     - No special characters (except hyphen)
     - Lowercase only
     - No duplicates

Tag Rules:
  - Required tags: 3 minimum
  - Optional tags: Up to 5 total
  - Auto-add mode tag: "template", "agent", or "blueprint"
  - Industry-specific if detected
  - Platform-specific if relevant

Examples:
  Template Mode â†’ ["template", "marketing", "email", "conversion", "b2b"]
  Agent Mode â†’ ["agent", "assistant", "coding", "python", "debugging"]
  Blueprint Mode â†’ ["blueprint", "midjourney", "product-photo", "ecommerce"]

Output:
  tags: string[] (3-5 items)
  primary_tag: string (most relevant)
  suggested_tags: string[] (additional options)
```

---

## ðŸ“ Title Generator System

### **Auto-Title Generation**
```yaml
Component: TitleGenerator
Mode: Automatic
Input:
  - mode: PromptMode
  - goal: User's primary goal
  - category: Assigned category
  - tags: Generated tags

Templates by Mode:
  Template:
    - "{Goal} Prompt Template"
    - "{Industry} {UseCase} Template"
    - "{Audience} {Tone} Prompt"
  
  Agent:
    - "{AgentName} - {Capability} Assistant"
    - "{PersonalityStyle} {Domain} Agent"
    - "{Title} AI Agent"
  
  Blueprint:
    - "{Platform} {MediaStyle} Blueprint"
    - "{UseCase} Media Generation"
    - "{MediaType} Creation Blueprint"

Refinement Rules:
  - Max length: 60 characters
  - Min length: 10 characters
  - Title case formatting
  - Remove redundant words
  - Add mode suffix if unclear
  - Ensure searchability

Examples:
  - "Sales Email Conversion Template"
  - "Dr. Data - Python Analytics Assistant"
  - "Midjourney Product Photography Blueprint"

Output:
  title: string
  alternative_titles: string[] (2-3 options)
  generation_method: "auto" | "manual" | "hybrid"
```

### **Manual Title Validation**
```yaml
Component: TitleValidator
Mode: Manual
Input:
  - user_title: string
  - existing_titles: string[] (for duplicate check)

Validation Rules:
  - Length: 10-60 characters
  - Characters: Letters, numbers, spaces, hyphens, colons
  - No profanity filter
  - No misleading terms
  - No trademark violations
  - Duplicate check (case-insensitive)

Enhancement Suggestions:
  - Add mode indicator if missing
  - Suggest category keyword
  - Improve searchability
  - Fix capitalization

Output:
  valid: boolean
  issues: string[]
  suggestions: string[]
  enhanced_title: string (optional)
```

### **Slug Generation**
```yaml
Component: SlugGenerator
Input:
  - title: Generated or validated title
  - id: Unique identifier (nanoid)
  - existing_slugs: string[] (for uniqueness)

Process:
  1. Convert to lowercase
  2. Replace spaces with hyphens
  3. Remove special characters
  4. Limit to 50 characters
  5. Append partial ID if duplicate
  6. Validate URL-safety

Format: {slug}-{partial-id}
Examples:
  - "sales-email-template-a1b2"
  - "python-analytics-agent-x9y8"
  - "product-photo-blueprint-m3n4"

Uniqueness Strategy:
  - Check against existing slugs
  - If duplicate, append 4-char from ID
  - If still duplicate, append 8-char
  - Maximum attempts: 3
  - Fallback: full ID appended

Output:
  slug: string
  is_unique: boolean
  collision_count: number
```

---

## ðŸš€ Emit Payload Structure

### **Payload Schema**
```yaml
PublishPayload {
  // Core Identity
  id: string (nanoid)
  slug: string (unique, URL-safe)
  title: string (validated/generated)
  mode: "template" | "agent" | "blueprint"
  
  // Classification
  category: string (auto/manual)
  tags: string[] (3-5 items)
  primary_tag: string
  
  // Content
  prompt: string (generated output)
  formData: object (user inputs)
  
  // Metadata
  created_at: timestamp
  updated_at: timestamp
  version: string (schema version)
  generator_version: string (AI model)
  
  // Quality Metrics
  trust_score: number (0-100)
  validation_status: object {
    passed: boolean
    warnings: string[]
    errors: string[]
  }
  
  // Publishing Info
  status: "draft" | "published" | "archived"
  visibility: "public" | "private" | "unlisted"
  author_id: string (optional)
  
  // Analytics Seeds
  view_count: 0
  copy_count: 0
  rating: null
  
  // Preflight Results
  preflight: {
    category_confidence: number
    tags_generated: boolean
    title_method: "auto" | "manual"
    slug_collisions: number
    validation_time_ms: number
  }
}
```

### **Emit Guardrails**
```yaml
Pre-Emit Validation:
  Required Fields:
    - id: Must be valid nanoid
    - slug: Must be unique and URL-safe
    - title: Must pass validation rules
    - mode: Must be valid enum
    - prompt: Must not be empty
    - category: Must be assigned
    - tags: Minimum 3 tags
    - trust_score: Must be calculated
  
  Content Sanitization:
    - Strip HTML/script from all text
    - Escape special characters
    - Validate JSON structure
    - Check payload size (<1MB)
  
  Security Checks:
    - No PII in public fields
    - No API keys in content
    - No injection patterns
    - Rate limiting applied

Emit Conditions:
  Allow Emit If:
    - All required fields present
    - Validation status.passed = true
    - Trust score > 50
    - No security violations
    - Payload size acceptable
  
  Block Emit If:
    - Missing required fields
    - Validation errors exist
    - Security checks fail
    - Duplicate slug detected
    - Rate limit exceeded

Fallback Strategy:
  On Emit Failure:
    1. Log detailed error
    2. Save to local draft
    3. Queue for retry
    4. Notify user
    5. Provide resolution steps
```

---

## ðŸ“Š Preflight Outcome Logging

### **Log Entry Schema**
```yaml
PreflightLog {
  // Timing
  timestamp: ISO-8601
  duration_ms: number
  
  // Identifiers
  session_id: string
  prompt_id: string
  user_id: string (optional)
  
  // Process Steps
  steps: {
    term_analysis: {
      success: boolean
      duration_ms: number
      keywords_extracted: number
    }
    category_assignment: {
      success: boolean
      method: "auto" | "manual" | "suggested"
      confidence: number
      category: string
    }
    tag_generation: {
      success: boolean
      count: number
      tags: string[]
      method: "auto" | "manual"
    }
    title_generation: {
      success: boolean
      method: "auto" | "manual" | "enhanced"
      original: string
      final: string
    }
    slug_creation: {
      success: boolean
      collisions: number
      attempts: number
      final_slug: string
    }
    validation: {
      success: boolean
      errors: string[]
      warnings: string[]
    }
    emit: {
      success: boolean
      status_code: number
      error: string (if failed)
    }
  }
  
  // Outcome
  overall_success: boolean
  failure_reason: string (if failed)
  recovery_action: string (if failed)
  
  // Performance
  total_duration_ms: number
  bottleneck_step: string
  
  // Metrics
  quality_metrics: {
    category_confidence: number
    tag_relevance: number
    title_quality: number
    slug_uniqueness: boolean
  }
}
```

### **Logging Destinations**
```yaml
Development:
  - Console: Detailed step-by-step
  - LocalStorage: Last 10 preflights
  - DevTools: Network tab for API calls
  
Production:
  - Error Service: Failures only
  - Analytics: Aggregated metrics
  - Database: Success summaries
  - Monitoring: Performance metrics

Log Levels:
  DEBUG: All step details
  INFO: Success/failure per step
  WARN: Validation issues, retries
  ERROR: Failures, blocked emits
  
Retention:
  Development: 7 days
  Production Success: 30 days
  Production Errors: 90 days
```

---

## ðŸ”„ Preflight State Machine

### **States**
```yaml
IDLE:
  â†’ ANALYZING (on publish trigger)

ANALYZING:
  â†’ CATEGORIZING (on terms extracted)
  â†’ ERROR (on extraction failure)

CATEGORIZING:
  â†’ TAGGING (on category assigned)
  â†’ USER_INPUT (on low confidence)

TAGGING:
  â†’ TITLING (on tags generated)
  â†’ ERROR (on tag failure)

TITLING:
  â†’ SLUGIFYING (on title ready)
  â†’ USER_INPUT (on manual title)

SLUGIFYING:
  â†’ VALIDATING (on slug created)
  â†’ RETRY (on collision)

VALIDATING:
  â†’ EMITTING (on validation pass)
  â†’ ERROR (on validation fail)

EMITTING:
  â†’ SUCCESS (on emit success)
  â†’ ERROR (on emit failure)

SUCCESS:
  â†’ IDLE (reset for next)

ERROR:
  â†’ RECOVERING (on retry available)
  â†’ FAILED (on max retries)

USER_INPUT:
  â†’ Previous state (on input received)
  â†’ CANCELLED (on user cancel)
```

---

## ðŸ“ˆ Success Metrics

### **Target Performance**
- Category auto-assignment: >70% accuracy
- Tag generation: >85% relevance
- Title auto-generation: >60% usage
- Slug uniqueness: 100% (guaranteed)
- Validation pass rate: >90%
- Emit success rate: >95%
- Total preflight time: <2 seconds

### **Quality Indicators**
- High confidence categories: >60%
- Manual intervention rate: <20%
- Slug collision rate: <5%
- Validation error rate: <10%
- Retry success rate: >80%

### **User Experience Goals**
- One-click publishing: 70% of cases
- Clear error messages: 100%
- Helpful suggestions: Always provided
- Recovery guidance: For all failures
- Progress visibility: Real-time updates

---

## âœ… Implementation Checklist

### **Phase 1: Term Preflight**
- [ ] Category analyzer algorithm
- [ ] Tag generator with TF-IDF
- [ ] Confidence scoring system
- [ ] Taxonomy database

### **Phase 2: Title & Slug**
- [ ] Title generation templates
- [ ] Manual title validator
- [ ] Slug generator with uniqueness
- [ ] Collision resolution

### **Phase 3: Payload & Emit**
- [ ] Payload schema validation
- [ ] Guardrail implementation
- [ ] Security checks
- [ ] Rate limiting

### **Phase 4: Logging**
- [ ] Log entry structure
- [ ] Multi-destination logging
- [ ] Performance metrics
- [ ] Error tracking

---

**Status:** PUBLISHING PREFLIGHT STAGED  
**Ready for:** Implementation planning  
**Next Step:** Component development