# ğŸ”§ v1.6 Component Split Plan

**Current State:** DynamicForm.tsx (1701 lines)  
**Target State:** 4 modular components (~2000 lines total)  
**Reduction Goal:** 15% less code through shared utilities

---

## ğŸ“‚ File Structure Map

```
client/src/components/
â”œâ”€â”€ forms/
â”‚   â”œâ”€â”€ TemplateForm.tsx       (~500 lines)
â”‚   â”œâ”€â”€ AgentForm.tsx          (~400 lines)
â”‚   â”œâ”€â”€ BlueprintForm.tsx      (~600 lines)
â”‚   â””â”€â”€ shared/
â”‚       â”œâ”€â”€ FormSharedComponents.tsx  (~200 lines)
â”‚       â”œâ”€â”€ FormSection.tsx           (~50 lines)
â”‚       â”œâ”€â”€ FormFieldWrapper.tsx      (~80 lines)
â”‚       â””â”€â”€ validation/
â”‚           â”œâ”€â”€ validators.ts         (~150 lines)
â”‚           â””â”€â”€ messages.ts           (~50 lines)
â”œâ”€â”€ DynamicForm.tsx            (~200 lines - orchestrator only)
â””â”€â”€ TrustSafetyPanel.tsx       (unchanged)
```

---

## ğŸ—ï¸ Component Architecture

### **1. DynamicForm.tsx (Orchestrator)**
**New Role:** Mode router and state manager
```typescript
// Pseudo-structure
DynamicForm {
  - Mode selection tabs
  - Lazy load mode-specific forms
  - Handle form submission
  - Manage generated prompt display
  - Coordinate with TrustSafetyPanel
}
```

### **2. TemplateForm.tsx**
**Sections to Extract:**
```typescript
TemplateForm {
  Sections:
    1. Prompt Basics (goal, keyOffer)
    2. Target Audience (audience, tone)
    3. Output Style (industry, experience, format)
    4. AI Model Selection (models, platformVersion)
    5. Advanced Settings (citation, rubric, etc.)
  
  Dependencies:
    - FormSection wrapper
    - FormFieldWrapper for consistent styling
    - Validation schema from validators.ts
}
```

### **3. AgentForm.tsx**
**Sections to Extract:**
```typescript
AgentForm {
  Sections:
    1. Agent Identity (title, agentName)
    2. Personality (context, personalityStyle)
    3. Capabilities (capabilities, constraints)
    4. Trust & Safety (inherited)
  
  Dependencies:
    - Shared textarea components
    - Personality selector component
    - Base validation rules
}
```

### **4. BlueprintForm.tsx**
**Sections to Extract:**
```typescript
BlueprintForm {
  Sections:
    1. Media Basics (title, description, style)
    2. Generator Settings (generator, agent)
    3. Output Specs (resolution, aspect, fileType)
    4. Platform Config (conditional fields)
    5. Advanced (mood, useCase, packaging)
  
  Dependencies:
    - Platform-specific field renderers
    - Media preset configurations
    - Complex conditional logic handlers
}
```

### **5. FormSharedComponents.tsx**
**Reusable Elements:**
```typescript
SharedComponents {
  - SectionCard (with dot indicator)
  - FieldLabel (with required asterisk)
  - FieldDescription (muted text)
  - ExampleText (italic style)
  - ValidationMessage (error/warning)
  - CollapsibleSection (for advanced)
  - MultiSelect (for AI models)
}
```

---

## ğŸ”„ Migration Strategy

### **Phase 1: Setup Infrastructure (1 hour)**
1. Create `forms/` directory structure
2. Setup shared components module
3. Create validation utilities
4. Establish prop interfaces

### **Phase 2: Extract Shared Components (1 hour)**
1. Identify common UI patterns
2. Create FormSection wrapper
3. Build FormFieldWrapper
4. Setup validation message components
5. Test in isolation

### **Phase 3: Split Forms (3 hours)**

**Order of extraction:**
1. **TemplateForm first** (least complex)
   - Extract sections 1-5
   - Wire up validation
   - Connect to parent state

2. **AgentForm second** (moderate)
   - Extract sections 1-4
   - Reuse shared components
   - Test personality selectors

3. **BlueprintForm last** (most complex)
   - Extract sections 1-5
   - Preserve platform logic
   - Maintain conditional renders

### **Phase 4: Update Orchestrator (1 hour)**
1. Refactor DynamicForm as router
2. Implement lazy loading
3. Setup mode-based imports
4. Connect submission handlers

### **Phase 5: Integration Testing (1 hour)**
1. Test mode switching
2. Verify form submissions
3. Check validation flow
4. Ensure no visual regression

---

## ğŸ“‹ Code Movement Checklist

### **From DynamicForm to TemplateForm:**
- [ ] Lines 234-567: Basic fields section
- [ ] Lines 678-834: Audience & tone section
- [ ] Lines 923-1124: Output style section
- [ ] Lines 1234-1423: AI models section
- [ ] Lines 1534-1656: Advanced settings

### **From DynamicForm to AgentForm:**
- [ ] Lines 234-423: Agent identity fields
- [ ] Lines 534-656: Personality section
- [ ] Lines 756-867: Capabilities fields
- [ ] Lines 1567-1634: Agent-specific trust

### **From DynamicForm to BlueprintForm:**
- [ ] Lines 234-534: Media basics
- [ ] Lines 645-823: Generator settings
- [ ] Lines 934-1234: Output specifications
- [ ] Lines 1345-1534: Platform configs
- [ ] Lines 1623-1701: Blueprint advanced

### **Shared Extractions:**
- [ ] Lines 45-123: Section wrapper pattern
- [ ] Lines 156-189: Field label component
- [ ] Lines 201-223: Validation display
- [ ] Lines 1678-1701: Submit button group

---

## ğŸ¯ Success Metrics

### **Before Split:**
- Single file: 1701 lines
- Load time: ~350ms
- Bundle impact: 180KB
- Test complexity: High

### **After Split Target:**
- Largest file: <600 lines
- Load time: <200ms (lazy)
- Bundle impact: <150KB (initial)
- Test complexity: Modular

### **Quality Gates:**
1. âœ… All forms render identically
2. âœ… Validation works per-mode
3. âœ… No prop drilling issues
4. âœ… State management intact
5. âœ… Zero visual regressions

---

## ğŸ”Œ Integration Points

### **Parent â†’ Child Data Flow:**
```
DynamicForm
  â”œâ”€â†’ mode selection
  â”œâ”€â†’ form ref
  â”œâ”€â†’ onSubmit handler
  â””â”€â†’ validation schema

TemplateForm/AgentForm/BlueprintForm
  â”œâ”€â†’ receives form context
  â”œâ”€â†’ renders mode fields
  â”œâ”€â†’ applies validation
  â””â”€â†’ emits form data
```

### **Child â†’ Parent Events:**
```
Form Components
  â”œâ”€â†’ field change events
  â”œâ”€â†’ validation status
  â”œâ”€â†’ submit readiness
  â””â”€â†’ error aggregation
```

---

## ğŸš€ Import Optimization

### **Lazy Loading Pattern:**
```typescript
// Pseudo-code structure
const TemplateForm = lazy(() => import('./forms/TemplateForm'))
const AgentForm = lazy(() => import('./forms/AgentForm'))
const BlueprintForm = lazy(() => import('./forms/BlueprintForm'))

// Suspense wrapper for loading states
<Suspense fallback={<FormSkeleton />}>
  {mode === 'template' && <TemplateForm {...props} />}
  {mode === 'agent' && <AgentForm {...props} />}
  {mode === 'blueprint' && <BlueprintForm {...props} />}
</Suspense>
```

---

## âœ… Verification Plan

1. **Visual regression test** - Screenshot comparison
2. **Functional test** - All forms submit correctly
3. **Performance test** - Measure load time improvement
4. **Bundle analysis** - Verify code splitting works
5. **Integration test** - Mode switching seamless

---

**Status:** Component split plan ready for v1.6 implementation